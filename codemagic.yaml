workflows:
  ios-workflow:
    name: iOS Build (App Store)
    max_build_duration: 60

    environment:
      node: latest
      xcode: latest
      cocoapods: default

      vars:
        TEAM_ID: "CKDUJJL6BZ"
        BUNDLE_ID: "com.donal.nextstepai"
        PROFILE_NAME: "nextstep-ai-appstore"

      ios_signing:
        distribution_type: app_store
        bundle_identifier: "com.donal.nextstepai"

    scripts:
      - name: Install dependencies
        script: |
          npm install

      - name: Sync Capacitor
        script: |
          npx cap sync ios

      - name: Set up code signing (KEY STEP)
        script: |
          set -e
          keychain initialize
          xcode-pr
